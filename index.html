<!DOCTYPE html>
<html>
<head>
  <title>Baba de Cascais</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Agenda de Jogos</h1>

  <select id="timeSelect">
    <option value="">Selecione um time</option>
  </select>

<div class="calendar-nav">
  <button id="prevMonth">&#9664;</button>
  <span id="monthLabel"></span>
  <button id="nextMonth">&#9654;</button>
</div>



  <div class="calendar" id="calendar"></div>

  <script>
    let dadosGlobal = null;
    let anoAtual, mesAtual;

    async function carregar() {
      const resp = await fetch("https://babadecascais.blob.core.windows.net/baba/jogos.json");
      dadosGlobal = await resp.json();

      const select = document.getElementById("timeSelect");
      dadosGlobal.times.forEach(time => {
        const opt = document.createElement("option");
        opt.value = time.nome;
        opt.textContent = time.nome;
        select.appendChild(opt);
      });

      const hoje = new Date();
      anoAtual = hoje.getFullYear();
      mesAtual = hoje.getMonth();

      select.addEventListener("change", () => {
        montarCalendario(select.value);
      });

      document.getElementById("prevMonth").addEventListener("click", () => {
        mesAtual--;
        if (mesAtual < 0) {
          mesAtual = 11;
          anoAtual--;
        }
        montarCalendario(select.value);
      });

      document.getElementById("nextMonth").addEventListener("click", () => {
        mesAtual++;
        if (mesAtual > 11) {
          mesAtual = 0;
          anoAtual++;
        }
        montarCalendario(select.value);
      });
    }

    function montarCalendario(nomeTime) {
      const calendar = document.getElementById("calendar");
      calendar.innerHTML = "";

      const monthLabel = document.getElementById("monthLabel");
      const nomeMes = new Date(anoAtual, mesAtual).toLocaleString("pt-PT", { month: "long", year: "numeric" });
      monthLabel.textContent = nomeMes.charAt(0).toUpperCase() + nomeMes.slice(1);

      const primeiroDia = new Date(anoAtual, mesAtual, 1);
      const ultimoDia = new Date(anoAtual, mesAtual + 1, 0);
      const diasNoMes = ultimoDia.getDate();

      const time = dadosGlobal.times.find(t => t.nome === nomeTime);
      if (!time) return;

      // preencher dias
      for (let dia = 1; dia <= diasNoMes; dia++) {
        const cell = document.createElement("div");
        cell.className = "day";

        const num = document.createElement("div");
        num.className = "day-number";
        num.textContent = dia;
        cell.appendChild(num);

        const dataStr = `${anoAtual}-${String(mesAtual+1).padStart(2,"0")}-${String(dia).padStart(2,"0")}`;
        const jogosDia = time.jogos.filter(j => j.data === dataStr);

        jogosDia.forEach((jogo, idx) => {
          const card = document.createElement("div");
      card.className = "jogo";
      card.innerHTML = `
        <span class="linha-jogo">
          <strong>${jogo.hora}</strong> <span class="local-icon"><svg class="pin-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="#e74c3c">
  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/>
</svg>
</span> ${jogo.local}  <span class="versus">vs ${jogo.adversario}</span>
        </span>
      `;


        
          const esc = document.createElement("div");
          esc.className = "escalados";
          esc.innerHTML = `<h4>Escalados:</h4>
                           <ul>${jogo.escalados.map(p => `<li>${p}</li>`).join("")}</ul>`;
          card.appendChild(esc);
        
          card.addEventListener("click", () => {
            esc.style.display = esc.style.display === "block" ? "none" : "block";
          });
        
          cell.appendChild(card);
        });


        calendar.appendChild(cell);
      }
    }

    carregar();
  </script>
</body>
</html>
