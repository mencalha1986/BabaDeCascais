<!DOCTYPE html>
<html>
<head>
  <title>Baba de Cascais</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Agenda de Jogos</h1>

  <select id="timeSelect">
    <option value="">Selecione um time</option>
  </select>

  <div class="calendar" id="calendar"></div>

  <script>
    let dadosGlobal = null;

    async function carregar() {
      const resp = await fetch("https://babadecascais.blob.core.windows.net/baba/jogos.json");
      dadosGlobal = await resp.json();

      const select = document.getElementById("timeSelect");
      dadosGlobal.times.forEach(time => {
        const opt = document.createElement("option");
        opt.value = time.nome;
        opt.textContent = time.nome;
        select.appendChild(opt);
      });

      select.addEventListener("change", () => {
        montarCalendario(select.value);
      });
    }

    function montarCalendario(nomeTime) {
      const calendar = document.getElementById("calendar");
      calendar.innerHTML = "";

      const hoje = new Date();
      const ano = hoje.getFullYear();
      const mes = hoje.getMonth(); // mÃªs atual

      const primeiroDia = new Date(ano, mes, 1);
      const ultimoDia = new Date(ano, mes + 1, 0);
      const diasNoMes = ultimoDia.getDate();

      const time = dadosGlobal.times.find(t => t.nome === nomeTime);
      if (!time) return;

      for (let dia = 1; dia <= diasNoMes; dia++) {
        const cell = document.createElement("div");
        cell.className = "day";

        const num = document.createElement("div");
        num.className = "day-number";
        num.textContent = dia;
        cell.appendChild(num);

        // procurar jogos nesse dia
        const dataStr = `${ano}-${String(mes+1).padStart(2,"0")}-${String(dia).padStart(2,"0")}`;
        const jogosDia = time.jogos.filter(j => j.data === dataStr);

        jogosDia.forEach((jogo, idx) => {
          const card = document.createElement("div");
          card.className = "jogo";
          card.textContent = `${jogo.hora} @ ${jogo.local}`;

          const esc = document.createElement("div");
          esc.className = "escalados";
          esc.innerHTML = `<h4>Escalados:</h4><ul>${jogo.escalados.map(p => `<li>${p}</li>`).join("")}</ul>`;
          card.appendChild(esc);

          card.addEventListener("click", () => {
            esc.style.display = esc.style.display === "block" ? "none" : "block";
          });

          cell.appendChild(card);
        });

        calendar.appendChild(cell);
      }
    }

    carregar();
  </script>
</body>
</html>
