<!DOCTYPE html>
<html>
<head>
  <title>Baba de Cascais</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Agenda de Jogos</h1>

  <select id="timeSelect">
    <option value="">Selecione um time</option>
  </select>

<button id="prevMonth">&lt;</button>
<span id="monthLabel"></span>
<button id="nextMonth">&gt;</button>


  <div class="calendar" id="calendar"></div>

  <script>
    let dadosGlobal = null;
    let anoAtual, mesAtual;

    async function carregar() {
      const resp = await fetch("https://babadecascais.blob.core.windows.net/baba/jogos.json");
      dadosGlobal = await resp.json();

      const select = document.getElementById("timeSelect");
      dadosGlobal.times.forEach(time => {
        const opt = document.createElement("option");
        opt.value = time.nome;
        opt.textContent = time.nome;
        select.appendChild(opt);
      });

      const hoje = new Date();
      anoAtual = hoje.getFullYear();
      mesAtual = hoje.getMonth();

      select.addEventListener("change", () => {
        montarCalendario(select.value);
      });

      document.getElementById("prevMonth").addEventListener("click", () => {
        mesAtual--;
        if (mesAtual < 0) {
          mesAtual = 11;
          anoAtual--;
        }
        montarCalendario(select.value);
      });

      document.getElementById("nextMonth").addEventListener("click", () => {
        mesAtual++;
        if (mesAtual > 11) {
          mesAtual = 0;
          anoAtual++;
        }
        montarCalendario(select.value);
      });
    }

    function montarCalendario(nomeTime) {
      const calendar = document.getElementById("calendar");
      calendar.innerHTML = "";

      const monthLabel = document.getElementById("monthLabel");
      const nomeMes = new Date(anoAtual, mesAtual).toLocaleString("pt-PT", { month: "long", year: "numeric" });
      monthLabel.textContent = nomeMes.charAt(0).toUpperCase() + nomeMes.slice(1);

      const primeiroDia = new Date(anoAtual, mesAtual, 1);
      const ultimoDia = new Date(anoAtual, mesAtual + 1, 0);
      const diasNoMes = ultimoDia.getDate();

      const time = dadosGlobal.times.find(t => t.nome === nomeTime);
      if (!time) return;

      // preencher dias
      for (let dia = 1; dia <= diasNoMes; dia++) {
        const cell = document.createElement("div");
        cell.className = "day";

        const num = document.createElement("div");
        num.className = "day-number";
        num.textContent = dia;
        cell.appendChild(num);

        const dataStr = `${anoAtual}-${String(mesAtual+1).padStart(2,"0")}-${String(dia).padStart(2,"0")}`;
        const jogosDia = time.jogos.filter(j => j.data === dataStr);

        jogosDia.forEach((jogo, idx) => {
          const card = document.createElement("div");
          card.className = "jogo";
          card.textContent = `${jogo.hora} @ ${jogo.local} 
                              | vs ${jogo.adversario}`;
        
          const esc = document.createElement("div");
          esc.className = "escalados";
          esc.innerHTML = `<h4>Escalados:</h4>
                           <ul>${jogo.escalados.map(p => `<li>${p}</li>`).join("")}</ul>`;
          card.appendChild(esc);
        
          card.addEventListener("click", () => {
            esc.style.display = esc.style.display === "block" ? "none" : "block";
          });
        
          cell.appendChild(card);
        });


        calendar.appendChild(cell);
      }
    }

    carregar();
  </script>
</body>
</html>
